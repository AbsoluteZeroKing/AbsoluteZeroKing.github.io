<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS作用域与变量提升、new与this指向、原型与原型链 | Leesdog的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="alternate" type="application/rss+xml" href="https://example.vuepress-theme-blog.billyyyyy3320.com/rss.xml" title="Leesdog的博客 RSS Feed">
    <meta name="description" content="JS的作用域和Java有一定区别，虽然名字上也分为局部作用域和全局作用域">
    
    <link rel="preload" href="/assets/css/0.styles.60a10e49.css" as="style"><link rel="preload" href="/assets/js/app.762240e8.js" as="script"><link rel="preload" href="/assets/js/7.ac404b9a.js" as="script"><link rel="preload" href="/assets/js/5.7b7cf407.js" as="script"><link rel="preload" href="/assets/js/22.6dd904da.js" as="script"><link rel="preload" href="/assets/js/8.b02a8171.js" as="script"><link rel="prefetch" href="/assets/js/10.ae5cb994.js"><link rel="prefetch" href="/assets/js/11.5014d578.js"><link rel="prefetch" href="/assets/js/12.27daf7f8.js"><link rel="prefetch" href="/assets/js/13.2c5e2571.js"><link rel="prefetch" href="/assets/js/14.b33af101.js"><link rel="prefetch" href="/assets/js/15.1e840a07.js"><link rel="prefetch" href="/assets/js/16.38daadbf.js"><link rel="prefetch" href="/assets/js/17.84b7c4ed.js"><link rel="prefetch" href="/assets/js/18.43381c27.js"><link rel="prefetch" href="/assets/js/19.b37aff45.js"><link rel="prefetch" href="/assets/js/20.169aefa2.js"><link rel="prefetch" href="/assets/js/21.aebd7e03.js"><link rel="prefetch" href="/assets/js/23.187e2dbe.js"><link rel="prefetch" href="/assets/js/24.fbf066c4.js"><link rel="prefetch" href="/assets/js/25.9f79a7ba.js"><link rel="prefetch" href="/assets/js/26.0847b1c1.js"><link rel="prefetch" href="/assets/js/27.c846cf16.js"><link rel="prefetch" href="/assets/js/28.93bf2646.js"><link rel="prefetch" href="/assets/js/29.4359646b.js"><link rel="prefetch" href="/assets/js/3.09d94a24.js"><link rel="prefetch" href="/assets/js/30.06365a24.js"><link rel="prefetch" href="/assets/js/31.266c0527.js"><link rel="prefetch" href="/assets/js/32.2dbb722b.js"><link rel="prefetch" href="/assets/js/33.d27f2f5b.js"><link rel="prefetch" href="/assets/js/34.c5f4f4b8.js"><link rel="prefetch" href="/assets/js/4.7d2ea1e7.js"><link rel="prefetch" href="/assets/js/6.06fc81ac.js"><link rel="prefetch" href="/assets/js/9.0d6b80d6.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.e0d5157c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.60a10e49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><header class="header"><div class="headerTitle"><a href="/" class="nav-link headerTitleLink">Leesdog的博客 </a></div> <div class="headerTags"><ul class="headerTagsNav"><li class="headerTagsNavItem"><a href="/" class="nav-link">首页</a></li><li class="headerTagsNavItem"><a href="/blog/" class="nav-link">记录</a></li><li class="headerTagsNavItem"><a href="/tags/" class="nav-link">标签</a></li><li class="headerTagsNavItem"><a href="/about/" class="nav-link">关于</a></li></ul></div> <div id="headerComponent"><div id="searchBox" class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></header> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Leesdog的博客 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">首页</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">记录</a></li><li class="mobile-nav-item"><a href="/tags/" class="nav-link">标签</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">关于</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        JS作用域与变量提升、new与this指向、原型与原型链
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2021-12-27T18:10:44.000Z">
      2021-12-27 18:10
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-5b1568b2><a href="/tags/JS" data-v-5b1568b2><span data-v-5b1568b2>JS</span></a></li><li class="post-tag" data-v-5b1568b2><a href="/tags/作用域" data-v-5b1568b2><span data-v-5b1568b2>作用域</span></a></li><li class="post-tag" data-v-5b1568b2><a href="/tags/变量提升" data-v-5b1568b2><span data-v-5b1568b2>变量提升</span></a></li><li class="post-tag" data-v-5b1568b2><a href="/tags/new" data-v-5b1568b2><span data-v-5b1568b2>new</span></a></li><li class="post-tag" data-v-5b1568b2><a href="/tags/this" data-v-5b1568b2><span data-v-5b1568b2>this</span></a></li><li class="post-tag" data-v-5b1568b2><a href="/tags/原型" data-v-5b1568b2><span data-v-5b1568b2>原型</span></a></li><li class="post-tag" data-v-5b1568b2><a href="/tags/原型链" data-v-5b1568b2><span data-v-5b1568b2>原型链</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="js作用域与变量提升、new与this指向、原型与原型链"><a href="#js作用域与变量提升、new与this指向、原型与原型链" class="header-anchor">#</a> JS作用域与变量提升、new与this指向、原型与原型链</h1> <p>[TOC]</p> <h3 id="js作用域与变量提升"><a href="#js作用域与变量提升" class="header-anchor">#</a> JS作用域与变量提升</h3> <p>JS的作用域和Java有一定区别，虽然名字上也分为局部作用域和全局作用域</p> <p><strong>局部作用域：<strong>也可以理解为</strong>函数作用域</strong>，只有在函数重声明的变量才会成为局部变量</p> <p>**全局作用域：**函数之外声明的变量均为全局变量</p> <p>几个关键点需要注意：</p> <ol><li><p>内部作用域可以访问外部作用域的变量，但外部不能访问内部(例如所有函数都可以访问window，但window不可能调用你后面声明的变量)</p></li> <li><p>JS有变量提升机制，即会提升到目前作用域的最高处，隐式出现（var变量提升只帮你声明该变量，但提升时不赋值，值默认为undefined；而函数变量提升则会将函数默认放到最上面最先加载）</p></li> <li><p>如果为尚未声明的变量赋值，此变量会自动成为全局变量(例如在函数内使用 a=10，a未被声明，则自动转换到全局window.a=10)。</p></li> <li><p>变量的查找顺序：</p> <p>先找自己的（包含变量提升），在找外部的；</p> <p>先找自己显式声明的，再找变量提升</p> <p>先找同名函数，再找同名变量（函数和变量都还未执行需要变量提升）</p> <p>先找同名变量，再找同名函数（函数和变量都执行了的情况下）</p> <p>例如下面这一段代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'aout'</span><span class="token punctuation">;</span>
<span class="token function">fun</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//隐式会按下列顺序出现这些</span>
    <span class="token comment">// var a=参数a</span>
    <span class="token comment">// var a='ain'</span>
    <span class="token comment">// function a(){console.log('a()');}</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'ain'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b()'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//最终的输出</span>
<span class="token comment">// ƒ a() { console.log('a()'); }</span>
<span class="token comment">// ain</span>
<span class="token comment">// ain</span>
<span class="token comment">// ƒ b() { console.log('b()'); }</span>
</code></pre></div></li></ol> <h3 id="new与this指向"><a href="#new与this指向" class="header-anchor">#</a> new与this指向</h3> <p>我们首先要理解new做了什么，翻阅MDN我们可以知道，new在底层其实做了这些：</p> <ol><li>创建一个空的简单JavaScript对象（即**{}**）；</li> <li>为步骤1新创建的对象添加属性**<strong>proto</strong>**，将该属性链接至构造函数的原型对象 ；</li> <li>将步骤1新创建的对象作为<strong>this</strong>的上下文 ；</li> <li>返回这个对象，如果该函数没有返回对象，则返回<strong>this</strong>。</li></ol> <p>这里我们先不深入理解，只需要知道两点:</p> <ul><li>new会创建一个新对象</li> <li>新对象会成为this的指向</li></ul> <p>至于new的细节到下面的原型与原型链中我们将做深层次的分析理解；</p> <p>来看下一段代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'111'</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fun<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第一个console处的fun，由于没有调用他，这里将其当作一个普通变量来看，所以打印出的就是他本身的函数内容</p> <blockquote><p>result：</p> <p>ƒ fun() {
this.a = '123';
console.log(this)
return '111'
}</p></blockquote> <p>第二个console处的fun()，将fun()当作静态函数调用，所以首先执行其内部代码，同时此处由于是在全局调用fun()，fun的this指向全局window，同时fun()返回值为111，所以最后打印结果如下</p> <blockquote><p>result:</p> <p>Window {window: Window, self: Window, document: document, a: &quot;123&quot;, location: Location, …}
111</p></blockquote> <p>第三个console处的new fun()，实例化了一个对象，此时将fun()作为对象挂载到了其调用的对象上(即window上)，然后执行fun()，此时fun()里面的this指向自己这个对象；然后new fun()返回的也是自己这个对象，所以console再次打印一次</p> <blockquote><p>result</p> <p>fun {a: &quot;123&quot;}
fun {a: &quot;123&quot;}</p></blockquote> <h3 id="原型与原型链"><a href="#原型与原型链" class="header-anchor">#</a> 原型与原型链</h3> <p>其实经过上面一系列demo例子我们感觉已经快能理解这些内容了，但我们其实已经可以感觉到了，函数的局部与全局作用域，以及new和this指向，背后有一层更加奇妙的东西在做支撑，为了搞清楚这其中到底做了什么，我们可以深入理解一下new所做的步骤；不过在此之前，我们先弄清其new的对象实现的原理</p> <p>我们都知道javaScript是一门支持面向对象的程序语言，但其与我们现在学习过的java，c++不同的是，JavaScript的面向对象是依靠<strong>原型和原型链</strong>所完成的</p> <p>当谈到继承时，JavaScript 只有一种结构：对象。每个实例对象（object）都有一个私有属性（称之为 <strong>proto</strong> ）指向它的构造函数的原型对象（<strong>prototype</strong>）。该原型对象也有一个自己的原型对象（<strong>proto</strong>），层层向上直到一个对象的原型对象为 <code>null</code>。根据定义，<code>null</code> 没有原型，并作为这个<strong>原型链</strong>中的最后一个环节。</p> <p>遵循ECMAScript标准，<code>someObject.[[Prototype]]</code> 符号是用于指向 <code>someObject</code> 的原型。从 ECMAScript 6 开始，<code>[[Prototype]]</code> 可以通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/GetPrototypeOf" target="_blank" rel="noopener noreferrer"><code>Object.getPrototypeOf()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf" target="_blank" rel="noopener noreferrer"><code>Object.setPrototypeOf()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 访问器来访问。这个等同于 JavaScript 的非标准但许多浏览器实现的属性 <code>__proto__</code>。</p> <p>但它不应该与构造函数 <code>func</code> 的 <code>prototype</code> 属性相混淆。被构造函数创建的实例对象的 <code>[[Prototype]]</code> 指向 <code>func</code> 的 <code>prototype</code> 属性。<strong><code>Object.prototype</code></strong> 属性表示 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noopener noreferrer"><code>Object</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的原型对象。</p> <p>上面说的比较绕，但是可以用几句话总结与完善</p> <ol><li><p>javascript一切皆为对象</p></li> <li><p>对象由Function创造，而Function本身也是对象</p></li> <li><p>每个对象都有一个隐式原型_proto_</p> <p>每个函数都有一个显式原型prototype</p></li> <li><p>对象的_proto_自己也是一个对象，指向其构造函数原型的prototype</p> <p>函数的prototype自己也是一个对象，其有一个属性值叫constructor，指向函数本身</p> <p>如下图:</p> <p><img src="https://image.leesdog.space/JS%E5%8E%9F%E5%9E%8B%E9%93%BE.png" alt="未命名文件"></p></li></ol> <p>同时由于function testFunc()是函数的同时本身其实也是一个对象，所以也有一个_proto_属性指向构造他的原型的prototype；</p> <p>补充上图</p> <p><img src="https://image.leesdog.space/js%E5%8E%9F%E5%9E%8B%E9%93%BE2.png" alt="未命名文件 (1)"></p> <p>继续套娃，由于prototype本身也是一个对象，所以它也有自己的_proto_，指向的是构建它的原型的prototype，谁构建的它呢，答案是Object本身，所以补充上图</p> <p><img src="https://image.leesdog.space/js%E5%8E%9F%E5%9E%8B%E9%93%BE3.png" alt="未命名文件 (2)"></p> <p>继续套娃，由于Object本身也是一个对象，所以其也有自己的proto，指向的是构造它的原型的prototype，前面已经说了，对象由Function构造，所以完善上图</p> <p><img src="https://image.leesdog.space/js%E5%8E%9F%E5%9E%8B%E9%93%BE4.png" alt="未命名文件 (3)"></p> <p>但是Object.prototype._proto_较为特殊，因为Obejct.prototype已经是顶级对象的原型了，而_proto_ 要指向构造其原型的prototype，这里是没有的，所以指向null</p> <p>同时由于函数对象都是被顶级构造函数Function所创建的，Function是被自身创建的，所以Function._proto_===Function.prototype</p> <p>同时由于Function.prototype本质上也是一个对象，所以其proto指向创建其原型的prototype，即Object.prototype</p> <p><img src="https://image.leesdog.space/js%E5%8E%9F%E5%9E%8B%E9%93%BE6.png" alt="未命名文件 (5)"></p> <p>接下来我们来看一下原型之间的继承关系</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 让我们从一个函数里创建一个对象o，它自身拥有属性a和b的：</span>
<span class="token keyword">let</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 这么写也一样
function f() {
  this.a = 1;
  this.b = 2;
}
*/</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: 1, b: 2}</span>

<span class="token comment">// 在f函数的原型上定义属性</span>
f<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
f<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">// 不要在 f 函数的原型上直接定义 f.prototype = {b:3,c:4};这样会直接打破原型链</span>
<span class="token comment">// o.[[Prototype]] 有属性 b 和 c</span>
<span class="token comment">//  (其实就是 o.__proto__ 或者 o.constructor.prototype)</span>
<span class="token comment">// o.[[Prototype]].[[Prototype]] 是 Object.prototype.</span>
<span class="token comment">// 最后o.[[Prototype]].[[Prototype]].[[Prototype]]是null</span>
<span class="token comment">// 这就是原型链的末尾，即 null，</span>
<span class="token comment">// 根据定义，null 就是没有 [[Prototype]]。</span>

<span class="token comment">// 综上，整个原型链如下:</span>

<span class="token comment">// {a:1, b:2} ---&gt; {b:3, c:4} ---&gt; Object.prototype---&gt; null</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token comment">// a是o的自身属性吗？是的，该属性的值为 1</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token comment">// b是o的自身属性吗？是的，该属性的值为 2</span>
<span class="token comment">// 原型上也有一个'b'属性，但是它不会被访问到。</span>
<span class="token comment">// 这种情况被称为&quot;属性遮蔽 (property shadowing)&quot;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
<span class="token comment">// c是o的自身属性吗？不是，那看看它的原型上有没有</span>
<span class="token comment">// c是o.[[Prototype]]的属性吗？是的，该属性的值为 4</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
<span class="token comment">// d 是 o 的自身属性吗？不是，那看看它的原型上有没有</span>
<span class="token comment">// d 是 o.[[Prototype]] 的属性吗？不是，那看看它的原型上有没有</span>
<span class="token comment">// o.[[Prototype]].[[Prototype]] 为 null，停止搜索</span>
<span class="token comment">// 找不到 d 属性，返回 undefined</span>
</code></pre></div><p>当访问一个对象的方法或属性时，我们会先找他自己本身的属性方法，如果没有我们会去其原型链中逐层查找其father有没有相应的方法(这和java,C++等面向对象的类十分相似)</p> <p>如何实现我们熟悉的这样一种继承关系呢？假设我想让son()函数继承自father()，在js里很容易，只需要挂件的一行代码：</p> <p><strong>son.prototype=new father()</strong></p> <p>这时我们就可以解释上面的疑问了，即new中间到底干了啥，总结起来四个步骤：</p> <ol><li>创建一个空的简单JavaScript对象（即**{}**）；</li> <li>为步骤1新创建的对象添加属性**<strong>proto</strong>**，将该属性链接至构造函数的原型对象的prototype ；</li> <li>将步骤1新创建的对象作为<strong>this</strong>的上下文 ；</li> <li>返回这个对象，如果该函数没有返回对象，则返回<strong>this</strong>。</li></ol> <p>所以我们可以手写出new这个函数的过程：</p> <div class="language- extra-class"><pre class="language-text"><code>function Mynew(constructor, argument) {
//1.创建一个空的简单JavaScript对象（即**{}**）；
const obj = {};
//2.为步骤1新创建的对象添加属性__proto__，将该属性链接至构造函数的原型对象的prototype ；
Object.setPrototypeOf(obj, constructor.prototype);
//3.将步骤1新创建的对象作为this的上下文 ；
constructor.call(obj, argument);
//4.如果该函数没有返回对象，则返回**this**。
return obj;
}

function Father(name) {
this.name = name;
console.log(this);
}

// 替换var father = new Father('lzs')
var father = Mynew(Father, 'lzs');
console.log(father.name);
</code></pre></div><p>最终结果：</p> <p><img src="https://image.leesdog.space/js%E5%8E%9F%E5%9E%8B%E9%93%BEnew%E6%BC%94%E7%A4%BA.png" alt="image-20220116180817902"></p></div> <footer></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h3 active"><a href="#js作用域与变量提升" title="JS作用域与变量提升">JS作用域与变量提升</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#new与this指向" title="new与this指向">new与this指向</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#原型与原型链" title="原型与原型链">原型与原型链</a></div></div></div></div> <footer class="footer" data-v-c7481560><div class="footer-left-wrap" data-v-c7481560><ul class="contact" data-v-c7481560><li class="contact-item" data-v-c7481560><a href="https://github.com/AbsoluteZeroKing" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-c7481560><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-c7481560></path></svg>
          
        </a></li><li class="contact-item" data-v-c7481560><a href="mailto:1932940046@qq.com" class="nav-link external" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-c7481560><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-c7481560></path><polyline points="22,6 12,13 2,6" data-v-c7481560></polyline></svg>
          
        </a></li><li class="contact-item" data-v-c7481560><a href="/" class="nav-link" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square" data-v-c7481560><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" data-v-c7481560></path></svg>
          
        </a></li><li class="contact-item" data-v-c7481560><a href="/" class="nav-link" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-music" data-v-c7481560><path d="M9 18V5l12-2v13" data-v-c7481560></path><circle cx="6" cy="18" r="3" data-v-c7481560></circle><circle cx="18" cy="16" r="3" data-v-c7481560></circle></svg>
          
        </a></li><li class="contact-item" data-v-c7481560><a href="tel:18064044601" class="nav-link external" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone" data-v-c7481560><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" data-v-c7481560></path></svg>
          
        </a></li><li class="contact-item" data-v-c7481560><a href="/" class="nav-link" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video" data-v-c7481560><polygon points="23 7 16 12 23 17 23 7" data-v-c7481560></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2" data-v-c7481560></rect></svg>
          
        </a></li><li class="contact-item" data-v-c7481560><a href="https://leesdog.space/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-c7481560><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe" data-v-c7481560><circle cx="12" cy="12" r="10" data-v-c7481560></circle><line x1="2" y1="12" x2="22" y2="12" data-v-c7481560></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" data-v-c7481560></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-c7481560><ul class="copyright" data-v-c7481560><li class="copyright-item" data-v-c7481560><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-c7481560>鄂ICP备19020804号-2</a></li><li class="copyright-item" data-v-c7481560>MIT Licensed</li></ul></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.762240e8.js" defer></script><script src="/assets/js/7.ac404b9a.js" defer></script><script src="/assets/js/5.7b7cf407.js" defer></script><script src="/assets/js/22.6dd904da.js" defer></script><script src="/assets/js/8.b02a8171.js" defer></script>
  </body>
</html>
